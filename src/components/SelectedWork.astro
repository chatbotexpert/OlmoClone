---
// SelectedWork.astro
import { Image } from 'astro:assets';

// Placeholder projects matching the brutalist aesthetic
const projects = [
  {
    title: "Aura Skincare",
    category: "Branding / E-com",
    image: "https://images.unsplash.com/photo-1556228578-0d85b1a4d571?auto=format&fit=crop&q=80&w=2600&ixlib=rb-4.0.3"
  },
  {
    title: "Nova Tech",
    category: "Web App / UI",
    image: "https://images.unsplash.com/photo-1550745165-9bc0b252726f?auto=format&fit=crop&q=80&w=2600&ixlib=rb-4.0.3"
  },
  {
    title: "Lumina Studio",
    category: "Portfolio / Motion",
    image: "https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?auto=format&fit=crop&q=80&w=2564&ixlib=rb-4.0.3"
  },
  {
    title: "Nexus Finance",
    category: "Fintech / Product",
    image: "https://images.unsplash.com/photo-1563986768494-4dee2763ff0f?auto=format&fit=crop&q=80&w=2600&ixlib=rb-4.0.3"
  }
];
---

<section class="bg-brutal-white text-brutal-black py-32 px-8 border-b border-brutal-black/10">
  <div class="max-w-screen-2xl mx-auto">
    <h2 class="font-heading font-bold text-4xl md:text-5xl lg:text-7xl uppercase tracking-tight mb-16 pb-2 flex flex-col gap-2 md:gap-6">
      <span>Selected</span>
      <span>Works <span class="text-brutal-orange text-[0.8em]">.</span></span>
    </h2>

    <div class="relative w-full border-t border-brutal-black/30" id="work-list">
      
      {projects.map((project, index) => (
        <a href={`/works/${project.title.toLowerCase().replace(/\s+/g, '-')}`} class="work-item group block border-b border-brutal-black/30 py-8 md:py-16 relative hover:bg-brutal-black/5 transition-colors duration-300">
          <div class="flex flex-col md:flex-row md:items-baseline justify-between gap-4 pointer-events-none px-4 md:px-8 relative z-10 text-brutal-black">
            <!-- Massive bold typography removed for normal styling -->
            <h3 transition:name={`title-${index}`} class="font-heading font-bold text-2xl md:text-4xl uppercase tracking-normal leading-[1.2] pb-2 group-hover:-translate-y-2 group-hover:text-brutal-orange transition-all duration-500">
              {project.title}
            </h3>
            <span class="font-body text-sm md:text-lg font-semibold tracking-widest uppercase opacity-60">
              {project.category}
            </span>
          </div>
          
          <!-- Mobile fallback gracefully degrades -->
          <div class="md:hidden mt-8 px-4 h-64 w-full overflow-hidden rounded-2xl relative">
             <Image 
               src={project.image} 
               alt={project.title} 
               width={800} height={600} 
               class="absolute inset-0 w-full h-full object-cover" 
               transition:name={`image-${index}-mobile`}
             />
          </div>
        </a>
      ))}

      <!-- Floating Image Container (Desktop Only, Magnetic Hover Follow) -->
      <!-- Preloads all images efficiently hidden away utilizing Astro's native optimizations -->
      <div id="hover-image-container" class="hidden md:block fixed top-0 left-0 w-[400px] h-[300px] pointer-events-none opacity-0 scale-90 z-[100] transition-[opacity,transform] duration-300 ease-out overflow-hidden rounded-3xl shadow-2xl">
        {projects.map((project, index) => (
          <Image 
            src={project.image} 
            alt={project.title} 
            width={800} height={600} 
            class="absolute inset-0 w-full h-full object-cover opacity-0 transition-opacity duration-300 pointer-events-none" 
            data-index={index}
            id={`hover-img-${index}`}
            transition:name={`image-${index}`}
          />
        ))}
      </div>

    </div>
    
    <div class="mt-16 flex justify-center">
      <a href="/work" class="inline-block border-2 border-brutal-black px-12 py-4 rounded-full font-body font-bold uppercase tracking-widest text-sm hover:bg-brutal-orange hover:border-brutal-orange hover:text-brutal-white transition-all transform hover:-translate-y-1 hover:shadow-lg">
        View All Works
      </a>
    </div>
  </div>
</section>

<script>
  function initMagneticHover() {
    const workItems = document.querySelectorAll('.work-item');
    const imageContainer = document.getElementById('hover-image-container');
    
    // Safety check + gate out mobile execution.
    if (!imageContainer || window.innerWidth < 768) return; 

    let isHovering = false;
    // Track target cursor coordinate
    let targetX = 0;
    let targetY = 0;
    // Track actual DOM element coordinate (for LERP)
    let currentX = 0;
    let currentY = 0;

    // Smooth magnetic follow using requestAnimationFrame Linear Interpolation (LERP)
    const animate = () => {
      if (isHovering) {
        // Linear interpolation step: (target - current) * friction
        currentX += (targetX - currentX) * 0.15;
        currentY += (targetY - currentY) * 0.15;
        
        // Center the 400x300 image container exactly on the cursor via offset translation
        // And apply a scale transformation for smooth fade-in scaling
        imageContainer.style.transform = `translate(${currentX - 200}px, ${currentY - 150}px) scale(1)`;
      }
      requestAnimationFrame(animate);
    };

    // Kickoff the render loop
    requestAnimationFrame(animate);

    workItems.forEach((item, index) => {
      
      item.addEventListener('mouseenter', () => {
        isHovering = true;
        imageContainer.style.opacity = '1';
        
        // Hide all sibling images
        const images = imageContainer.querySelectorAll('img');
        images.forEach(img => img.style.opacity = '0');
        
        // Show current image strictly by index
        const activeImg = document.getElementById(`hover-img-${index}`);
        if(activeImg) {
          activeImg.style.opacity = '1';
        }
      });

      // Update cursor position directly from MouseEvent relative to viewport
      item.addEventListener('mousemove', (e) => {
        const mouseEvent = e as MouseEvent;
        targetX = mouseEvent.clientX;
        targetY = mouseEvent.clientY;
      });

      item.addEventListener('mouseleave', () => {
        isHovering = false;
        imageContainer.style.opacity = '0';
        // Reset scale but keep position trailing
        imageContainer.style.transform = `translate(${currentX - 200}px, ${currentY - 150}px) scale(0.9)`;
      });
    });
  }

  // Support Astro View Transitions natively without re-registering
  document.addEventListener('astro:page-load', initMagneticHover);
  
  // Safe init for standard document load cycles
  if (document.readyState === 'complete' || document.readyState === 'interactive') {
    initMagneticHover();
  } else {
    document.addEventListener('DOMContentLoaded', initMagneticHover);
  }
</script>
